version: '3'
services:
  trump-postgis:
    image: slothofanarchy/trump-postgis
    build: ./postgis/
    env_file:
      - ./postgis/env
    volumes:
      - data:/var/lib/postgresql/data
    restart: on-failure
  trump-mapnik:
    image: slothofanarchy/trump-mapnik
    build: ./mapnik/
    links:
      - trump-postgis
    tty: true
    volumes:
      - cache:/var/lib/mod_tile
    restart: on-failure
  trump-area:
    image: slothofanarchy/trump-area
    build: ./area/
    links:
      - trump-postgis
    tty: true
    restart: on-failure
  trump-label:
    image: slothofanarchy/trump-label
    build: ./label/
    tty: true
    volumes:
      - labels:/home/osm/labels
    restart: on-failure
  trump-client:
    image: slothofanarchy/trump-client
    build: ./client/
    tty: true
    restart: on-failure
    depends_on:
      - trump-mapnik
      - trump-area
      - trump-label
    ports:
      - 80:80
  ouroboros:
    container_name: ouroboros
    hostname: ouroboros
    image: pyouroboros/ouroboros
    environment:
      - CLEANUP=true
      - INTERVAL=30
      - LOG_LEVEL=debug
      - SELF_UPDATE=true
      - TZ=Europe/Berlin
      - LATEST=true
    restart: unless-stopped
    volumes:
      - /var/run/docker.sock:/var/run/docker.sock
volumes:
  data: {} # postgis data
  cache: {} # mapnik tile cache
  labels: {} # dir for label ce file
